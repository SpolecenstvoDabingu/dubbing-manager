{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load one_key_dict %}
{% load object_filter %}
{% load to_utc_iso %}


{% block content %}
<h2 class="text-white">{% trans "frontend.home.not_done_title" context "Title not done for table" %}</h2>
<div class="table-responsive mb-2">
  <table class="table table-striped table-hover text-white">
    <thead>
      <tr>
        <th class="col-3 text-center">{% trans "frontend.home.name" context "Title name for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.deadline" context "Title deadline for not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.type" context "Title type for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.character_s" context "Title charater's for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.script" context "Title script for done/not done" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for item in not_done %}
      <tr>
        <td 
          class="text-center align-middle{% if item.object.cover or item.dubbing.cover %} bg-cover{% endif %}"
          {% if item.object.cover %}style="background-image: url({{ item.object.cover.url }});"{% elif item.dubbing.cover %}style="background-image: url({{ item.dubbing.cover.url }});"{% endif %}>
          <a href="{% if item.type == 'episode' %}{% url 'stats_episode' item.object.id %}{% elif item.type == 'scene' %}{% url 'stats_scene' item.object.id %}{% endif %}">
            <b class="text-white">{{ item.object.name }}</b>
          </a>
        </td>
        <td class="text-center align-middle"><span class="countdown" data-deadline="{{ item.object.deadline|to_utc_iso:"True" }}" data-started="{{ item.object.started|to_utc_iso:"True" }}"></span></td>
        <td class="text-center align-middle">
          {% if item.type == "episode" %}
              {% trans "frontend.home.episode_title" context "Episode title for type" %}
          {% elif item.type == "scene" %}
              {% trans "frontend.home.scene_title" context "Scene title for type" %}
          {% endif %}
        </td>
        <td class="text-center align-middle">
            {% for uc in item.object.user_characters %}
                <span
                    style="
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        cursor: pointer;
                    "
                    data-toggle="modal" 
                    data-target="#imageModal" 
                    data-img-alt="{{ uc.name }}"
                    data-img-url="{{ uc.image }}"
                    title="{{ uc.name }}"
                >{{ uc.name }}</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </td>
        <td class="text-center align-middle">
            {% if item.type == "episode" %}
                <a href="{% url 'download_script' 'episode' item.object.id %}" class="btn btn-primary">
                    {% trans "frontend.home.download_script" context "Download script button title" %}
                </a>
            {% elif item.type == "scene" %}
                <a href="{% url 'download_script' 'scene' item.object.id %}" class="btn btn-primary">
                    {% trans "frontend.home.download_script" context "Download script button title" %}
                </a>
            {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center">{% trans "frontend.home.no_items_found" context "No items found for done/not done" %}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

  <h2 class="mt-5 text-white">{% trans "frontend.home.done_title" context "Title done for table" %}</h2>
  {% regroup done by dubbing as dubbing_groups %}
  {% for group in dubbing_groups %}
  <h4
    class="text-white py-3{% if group.grouper.cover %} bg-cover{% endif %}"
    {% if group.grouper.cover %}style="background-image: url({{ group.grouper.cover.url }});"{% endif %}>
    <a href="{% url 'stats_dubbing' group.grouper.id %}" class="text-white mx-md-3">
      <b>{{ group.grouper.name }}</b>
    </a>
  </h4>
<div class="table-responsive mb-2">
  <table class="table table-striped table-hover text-white">
    <thead>
      <tr>
        <th class="col-3 text-center">{% trans "frontend.home.name" context "Title name for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.started" context "Title started for done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.type" context "Title type for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.character_s" context "Title charater's for done/not done" %}</th>
        <th class="col-3 text-center">{% trans "frontend.home.script" context "Title script for done/not done" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for item in group.list %}
      <tr>
        <td
          class="text-center align-middle{% if item.cover or group.grouper.cover %} bg-cover{% endif %}"
          {% if item.object.cover %}style="background-image: url({{ item.object.cover.url }});"
          {% elif group.grouper.cover %}style="background-image: url({{ group.grouper.cover.url }});"
          {% endif %}>
          <a href="{% if item.type == 'episode' %}{% url 'stats_episode' item.object.id %}{% elif item.type == 'scene' %}{% url 'stats_scene' item.object.id %}{% endif %}">
            <b class="text-white">{{ item.object.name }}</b>
          </a>
        </td>
        <td class="text-center align-middle">{{ item.object.started }}</td>
        <td class="text-center align-middle">
          {% if item.type == "episode" %}
              {% trans "frontend.home.episode_title" context "Episode title for type" %}
          {% elif item.type == "scene" %}
              {% trans "frontend.home.scene_title" context "Scene title for type" %}
          {% endif %}
        </td>
        <td class="text-center align-middle">
            {% for uc in item.object.user_characters %}
                <span
                    style="
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        cursor: pointer;
                    "
                    data-toggle="modal" 
                    data-target="#imageModal" 
                    data-img-alt="{{ uc.name }}"
                    data-img-url="{{ uc.image }}"
                    title="{{ uc.name }}"
                >{{ uc.name }}</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </td>
        <td class="text-center align-middle">
            {% if item.type == "episode" %}
                <a href="{% url 'download_script' 'episode' item.object.id %}" class="btn btn-primary">
                    {% trans "frontend.home.download_script" context "Download script button title" %}
                </a>
            {% elif item.type == "scene" %}
                <a href="{% url 'download_script' 'scene' item.object.id %}" class="btn btn-primary">
                    {% trans "frontend.home.download_script" context "Download script button title" %}
                </a>
            {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center">{% trans "frontend.home.no_items_found" context "No items found for done/not done" %}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endfor %}
{% include "components/image_modal.html" %}

{% endblock %}